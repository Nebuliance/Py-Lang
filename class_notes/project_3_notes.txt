/*
  Env = environment
  S = scope
*/

resave(e, Env)
  case IdExpr:
    d = lookup(e.id, Env)
    e.ref = d
  
  case AbsExpr:
    Env = Env + [{e.val.id; e.val}]
    *restoreId*(e, expr, Env)
  
  case LambdaExpr:
    params = 
          {v.Id: v

          for v in e.val}

lookup(Id, Env)
  for S in *revisited*(Env):
    if Id in S:
      return S[Id]
  return name

